<!-- ======================================================
     DESTINY CLOCK PANEL (HIDDEN UNTIL COMMAND)
======================================================= -->
<section class="cosmicPanel" id="destinyClockPanel" style="display:none;">
  <h2>ðŸœ‚ FlightLine Destiny Clock</h2>
  <p class="small muted">
    Sovereign cosmic briefing. Activated by command.<br>
    (Planetary â†’ Solar â†’ Galactic â†’ Alignment â†’ Law)
  </p>

  <!-- Planetary Countdown -->
  <div class="stepCard">
    <div class="stepTitle">Planetary Countdown</div>
    <div id="destinyPlanetary" class="muted"></div>
  </div>

  <!-- Solar Position -->
  <div class="stepCard">
    <div class="stepTitle">Solar Position</div>
    <div id="destinySolar" class="muted"></div>
  </div>

  <!-- Galactic Position -->
  <div class="stepCard">
    <div class="stepTitle">Galactic Position</div>
    <div id="destinyGalactic" class="muted"></div>
  </div>

  <!-- Daily Alignment -->
  <div class="stepCard">
    <div class="stepTitle">Daily Alignment Protocol</div>
    <div id="destinyAlignment" class="muted"></div>
  </div>

  <!-- Closing Law -->
  <div class="stepCard" style="border-color:var(--runway-accent2);">
    <div class="stepTitle" style="color:var(--runway-accent2);">Closing Law</div>
    <div id="destinyLaw" class="muted"></div>
  </div>
</section>


<script>
/* =========================================================
   BLOCK 4 â€” CLOSING LAW SENTENCE ENGINE
========================================================= */
function generateClosingLaw(planet, solarPct, galacticPct){
  const LAWS = [
    `${planet} frames the motion; remain steady.`,
    `When the solar field shifts, adjust without resistance.`,
    `Galactic drift is slow, but direction is absolute.`,
    `Return to alignment before initiating force.`,
    `A cycle completed is a responsibility renewed.`,
    `Position decides outcome more than pressure.`,
    `Move only when the signal and the season match.`,
    `Silence is a vector; clarity is a tool.`,
    `Trajectory determines destiny; refine the arc.`,
    `Nothing accelerates fate like disciplined stillness.`
  ];

  const idx = Math.floor((solarPct + galacticPct) % LAWS.length);
  return LAWS[idx];
}

/* =========================================================
   BLOCK 5 â€” DESTINY CLOCK RENDER ENGINE (FINAL, CLEAN)
========================================================= */
function renderDestinyClock(birthUTC){
  const panel = document.getElementById("destinyClockPanel");
  panel.style.display = "block";

  const age = computeEarthAge(birthUTC);
  const planets = computePlanetaryAges(age);

  // Nearest planetary birthday
  const next = planets.reduce((a,b)=> a.remaining < b.remaining ? a : b);

  document.getElementById("destinyPlanetary").innerHTML =
    `${next.planet} â†’ ${next.remaining.toFixed(2)}% until reset`;

  // Solar rotation + activity
  const now = Date.now();
  const solarRot = pctThroughCycle(now, COSMIC_CYCLES[0].anchor_utc, COSMIC_CYCLES[0].period_days);
  const solarAct = pctThroughCycle(now, COSMIC_CYCLES[1].anchor_utc, COSMIC_CYCLES[1].period_days);

  document.getElementById("destinySolar").innerHTML =
    `Rotation: ${solarRot.toFixed(2)}%<br>
     Activity Cycle: ${solarAct.toFixed(2)}%`;

  // Galactic position
  const gal = pctThroughCycle(now, COSMIC_CYCLES[5].anchor_utc, COSMIC_CYCLES[5].period_days);
  document.getElementById("destinyGalactic").innerHTML =
    `${gal.toFixed(6)}% through galactic orbit`;

  // Daily alignment
  const align = computeDailyAlignment(age);
  document.getElementById("destinyAlignment").innerHTML =
    `${align.planet} â†’ ${align.title}<br>${align.action}`;

  // Closing law sentence
  const law = generateClosingLaw(align.planet, solarAct, gal);
  document.getElementById("destinyLaw").innerHTML = law;
}

/* =========================================================
   COMMAND HANDLER EXTENSION (DESTINY CLOCK)
========================================================= */
function handleDestinyClockCommand(cmd){
  if(cmd !== "destiny clock") return false;

  const birthStr = document.getElementById("birthInput").value;
  if(!birthStr){
    pushConsole("[ERROR] Enter birthdate first.");
    return true;
  }

  const [y,m,d] = birthStr.split("-").map(Number);
  const birthUTC = Date.UTC(y,m-1,d);

  renderDestinyClock(birthUTC);
  document.getElementById("destinyClockPanel")
    .scrollIntoView({behavior:"smooth"});

  pushConsole("[DESTINY CLOCK ACTIVATED]");
  return true;
}

/* =========================================================
   PATCH COMMAND SYSTEM TO INCLUDE DESTINY CLOCK
========================================================= */
const oldRunCommand = runCommand;
runCommand = function(cmd){
  cmd = cmd.toLowerCase().trim();

  if(handleDestinyClockCommand(cmd)) return;
  oldRunCommand(cmd);
};
</script>
